# Command + / でコメントアウトする設定

## 問題
iTerm2 では、`Command + /` が検索/ハイライト機能に割り当てられているため、Neovim に送信されません。
この機能を無効化して、Neovim で `Command + /` を使えるようにする必要があります。

## 解決方法: iTerm2 の設定

### 手順1: iTerm2 の設定を開く

1. `iTerm2` → `Preferences`（または `⌘,`）を開く

### 手順2: Key Bindings で Command + / を確認・無効化

1. `Preferences` → `Keys` → `Key Bindings` を開く
2. 検索ボックスに `⌘/` または `Command+/` と入力して検索
3. `⌘/` のキーバインドが見つかった場合：
   - **方法A（推奨）**: キーバインドを削除
     - 該当するキーバインドを選択して、`-` ボタンをクリックして削除
   - **方法B**: キーバインドを空のアクションに変更
     - 該当するキーバインドを選択
     - アクションを「Send Text」に変更し、送信するテキストを空にする

4. **`⌘/` のキーバインドが見つからない場合（デフォルト動作の場合）**:
   - iTerm2 のデフォルトの動作として `Command + /` がハイライト機能に割り当てられている可能性があります
   - この場合、新しいキーバインドを追加して上書きします：
     - `Key Bindings` セクションの左下にある `+` ボタンをクリック
     - `Keyboard Shortcut` フィールドで `Command + /` を押す
     - `Action` ドロップダウンメニューから `Send Text` を選択
     - **重要**: 送信するテキストに **` c`** (スペース + c) と入力する
       - **注意**: `<leader>c` や `<leader>c` ではなく、**スペース + c** を入力してください
       - iTerm2 の `Send Text` では `<leader>` のような特殊文字は展開されません
       - `<leader>` はスペースに設定されているため、` c` を送信すると `<leader>c` が実行されます
       - 既に `<leader>c` でコメントアウト機能が設定されているため、これで確実に動作します
       - 空のままでは Neovim に何も送信されません
     - **重要**: 「Apply to...」のドロップダウンメニューから **「Apply to current session」** を選択
       - これにより、現在の Neovim セッションにのみ送信されます
       - 他の選択肢（「Apply to all sessions」「Apply to broadcasted-to sessions」など）は避けてください
     - これにより、デフォルトのハイライト機能が無効化され、Neovim に `<leader>c` が送信されます

### 手順3: 他の設定タブも確認

`Command + /` が Key Bindings に見つからない場合、以下のタブも確認してください：

1. **Shortcuts タブ**:
   - `Preferences` → `Keys` → `Shortcuts` を開く
   - 検索機能やハイライト機能に関連するショートカットがないか確認

2. **System タブ**:
   - `Preferences` → `Keys` → `System` を開く
   - システムレベルのショートカットが無効化されているか確認

### 手順4: 設定の確認

1. iTerm2 を再起動して設定を反映
2. Neovim を起動
3. 任意の行で `Command + /` を押す
4. コメントアウトされれば成功
5. ハイライト機能が動作しなければ成功

## Neovim 側の設定

Neovim 側では既に `<leader>c` でコメントアウト機能が設定されています。
- iTerm2 で `Command + /` を ` c` (スペース + c) として送信する設定が必要です
- `<leader>` はスペースに設定されているため、` c` を送信すると `<leader>c` が実行されます
- Normal Mode: `Command + /` で現在の行をコメントアウト/解除
- Visual Mode: `Command + /` で選択した複数行をコメントアウト/解除

設定ファイル: `.config/nvim/lua/core/keymaps.lua`

**注意**: この方法は既存の `<leader>c` 設定を利用するため、確実に動作します。

## 動作確認

1. Neovim を起動
2. 任意の行で `Command + /` を押す
3. コメントアウトされれば成功
4. Visual Mode で複数行を選択して `Command + /` を押す
5. 選択した行が全てコメントアウトされれば成功

## トラブルシューティング

### `der>c` や `<leader>c` が表示される場合

- **原因**: iTerm2 の `Send Text` に `<leader>c` や `<leader>c` を入力してしまっている
- **解決方法**: 
  1. iTerm2 の Key Bindings で `Command + /` の設定を開く
  2. 送信するテキストを **` c`** (スペース + c) に変更
  3. `<leader>` や `<leader>` などの文字列ではなく、**スペース + c** を入力してください
  4. Neovim を再起動して動作を確認

### `Command + /` を押しても反応しない場合

1. iTerm2 の Key Bindings で `⌘/` が完全に削除されているか確認
2. Neovim を再起動して設定を読み込み直す
3. `:checkhealth` で Comment.nvim プラグインが正しく読み込まれているか確認

### ハイライト機能がまだ動作する場合

1. iTerm2 の Key Bindings で `⌘/` を再度検索
2. 複数のキーバインドが存在する可能性があるため、全て削除
3. **新しいキーバインドを追加して上書き**:
   - `Key Bindings` の `+` ボタンをクリック
   - `Command + /` を押してキーバインドを設定
   - `Action` を `Send Text` に設定し、送信するテキストに **` c`** (スペース + c) と入力
     - **注意**: `<leader>c` や `<leader>c` ではなく、**スペース + c** を入力してください
   - **重要**: 「Apply to...」のドロップダウンメニューから **「Apply to current session」** を選択
   - これにより、デフォルトの動作を上書きし、Neovim に `<leader>c` が送信されます
4. iTerm2 を再起動して設定を反映
5. macOS のシステム環境設定も確認:
   - システム環境設定 → キーボード → ショートカット
   - アプリケーション固有のショートカットで iTerm2 に関連する設定がないか確認

### その他の問題

- Comment.nvim プラグインがインストールされていない場合：
  - `:Lazy` でプラグインをインストール
- 言語によってコメント記号が認識されない場合：
  - Comment.nvim は自動的にファイルタイプを認識しますが、`:set filetype?` でファイルタイプを確認

