# Command + / でコメントアウトする設定

## 問題
iTerm2 では、`Command + /` が検索/ハイライト機能に割り当てられているため、Neovim に送信されません。
この機能を無効化して、Neovim で `Command + /` を使えるようにする必要があります。

## 解決方法: iTerm2 の設定

### 手順1: iTerm2 の設定を開く

1. `iTerm2` → `Preferences`（または `⌘,`）を開く

### 手順2: Key Bindings で Command + / を確認・無効化

1. `Preferences` → `Keys` → `Key Bindings` を開く
2. 検索ボックスに `⌘/` または `Command+/` と入力して検索
3. `⌘/` のキーバインドが見つかった場合：
   - **方法A（推奨）**: キーバインドを削除
     - 該当するキーバインドを選択して、`-` ボタンをクリックして削除
   - **方法B**: キーバインドを空のアクションに変更
     - 該当するキーバインドを選択
     - アクションを「Send Text」に変更し、送信するテキストを空にする

4. **`⌘/` のキーバインドが見つからない場合（デフォルト動作の場合）**:
   - iTerm2 のデフォルトの動作として `Command + /` がハイライト機能に割り当てられている可能性があります
   - この場合、新しいキーバインドを追加して上書きします：
     - `Key Bindings` セクションの左下にある `+` ボタンをクリック
     - `Keyboard Shortcut` フィールドで `Command + /` を押す
     - `Action` ドロップダウンメニューから `Send Text` を選択
     - 送信するテキストを空にする（または、Neovim に送信したい文字列を入力）
     - **重要**: 「Apply to...」のドロップダウンメニューから **「Apply to current session」** を選択
       - これにより、現在の Neovim セッションにのみ送信されます
       - 他の選択肢（「Apply to all sessions」「Apply to broadcasted-to sessions」など）は避けてください
     - これにより、デフォルトのハイライト機能が無効化されます

### 手順3: 他の設定タブも確認

`Command + /` が Key Bindings に見つからない場合、以下のタブも確認してください：

1. **Shortcuts タブ**:
   - `Preferences` → `Keys` → `Shortcuts` を開く
   - 検索機能やハイライト機能に関連するショートカットがないか確認

2. **System タブ**:
   - `Preferences` → `Keys` → `System` を開く
   - システムレベルのショートカットが無効化されているか確認

### 手順4: 設定の確認

1. iTerm2 を再起動して設定を反映
2. Neovim を起動
3. 任意の行で `Command + /` を押す
4. コメントアウトされれば成功
5. ハイライト機能が動作しなければ成功

## Neovim 側の設定

Neovim 側では既に `<D-/>` (Command + /) の設定が追加されています。
- Normal Mode: `Command + /` で現在の行をコメントアウト/解除
- Visual Mode: `Command + /` で選択した複数行をコメントアウト/解除

設定ファイル: `.config/nvim/lua/core/keymaps.lua`

## 動作確認

1. Neovim を起動
2. 任意の行で `Command + /` を押す
3. コメントアウトされれば成功
4. Visual Mode で複数行を選択して `Command + /` を押す
5. 選択した行が全てコメントアウトされれば成功

## トラブルシューティング

### `Command + /` を押しても反応しない場合

1. iTerm2 の Key Bindings で `⌘/` が完全に削除されているか確認
2. Neovim を再起動して設定を読み込み直す
3. `:checkhealth` で Comment.nvim プラグインが正しく読み込まれているか確認

### ハイライト機能がまだ動作する場合

1. iTerm2 の Key Bindings で `⌘/` を再度検索
2. 複数のキーバインドが存在する可能性があるため、全て削除
3. **新しいキーバインドを追加して上書き**:
   - `Key Bindings` の `+` ボタンをクリック
   - `Command + /` を押してキーバインドを設定
   - `Action` を `Send Text` に設定し、送信するテキストを空にする
   - **重要**: 「Apply to...」のドロップダウンメニューから **「Apply to current session」** を選択
   - これにより、デフォルトの動作を上書きできます
4. iTerm2 を再起動して設定を反映
5. macOS のシステム環境設定も確認:
   - システム環境設定 → キーボード → ショートカット
   - アプリケーション固有のショートカットで iTerm2 に関連する設定がないか確認

### その他の問題

- Comment.nvim プラグインがインストールされていない場合：
  - `:Lazy` でプラグインをインストール
- 言語によってコメント記号が認識されない場合：
  - Comment.nvim は自動的にファイルタイプを認識しますが、`:set filetype?` でファイルタイプを確認

